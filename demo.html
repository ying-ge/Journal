<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¼©å†™ç‰‡æ®µæœç´¢æ¼”ç¤º</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 { color: #333; }
        .demo-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .example {
            background: #f9f9f9;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
            border-radius: 4px;
        }
        .example input {
            padding: 8px;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .example button {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .example button:hover { background: #0056b3; }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #e8f5e9;
            border-radius: 4px;
            display: none;
        }
        .result.show { display: block; }
        .highlight { color: #007bff; font-weight: bold; }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ç¼©å†™ç‰‡æ®µæœç´¢åŠŸèƒ½æ¼”ç¤º</h1>

    <div class="demo-section">
        <h2>åŠŸèƒ½è¯´æ˜</h2>
        <p>ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨å¤šç§æ–¹å¼æœç´¢æœŸåˆŠï¼š</p>
        <ul>
            <li><strong>å®Œæ•´æœŸåˆŠåï¼š</strong> <code>Molecular Cancer</code></li>
            <li><strong>é¦–å­—æ¯ç¼©å†™ï¼š</strong> <code>mc</code> (æ¥è‡ª Molecular Cancer)</li>
            <li><strong>ç¼©å†™ç‰‡æ®µï¼ˆæ–°ï¼ï¼‰ï¼š</strong> <code>mol can</code> (åˆ†åˆ«åŒ¹é… Molecular å’Œ Cancer)</li>
            <li><strong>å‰ç¼€åŒ¹é…ï¼š</strong> <code>mol</code> (æœŸåˆŠåä»¥ mol å¼€å¤´)</li>
        </ul>
    </div>

    <div class="demo-section">
        <h2>äº¤äº’å¼æµ‹è¯•</h2>
        <div style="margin-bottom: 15px;">
            <input type="text" id="searchInput" placeholder="è¾“å…¥æœç´¢è¯..." style="width: 60%; padding: 10px; font-size: 16px;">
            <button onclick="performSearch()" style="padding: 10px 20px; font-size: 16px;">æœç´¢</button>
        </div>
        <div id="searchResult" class="result"></div>
    </div>

    <div class="demo-section">
        <h2>ç¤ºä¾‹æµ‹è¯•ç”¨ä¾‹</h2>

        <div class="example">
            <h3>ç¤ºä¾‹ 1: ç¼©å†™ç‰‡æ®µæœç´¢</h3>
            <p>è¾“å…¥ <code>mol can</code> æœç´¢ "Molecular Cancer"</p>
            <input type="text" value="mol can" readonly>
            <button onclick="testSearch('mol can')">æµ‹è¯•</button>
            <div id="result1" class="result"></div>
        </div>

        <div class="example">
            <h3>ç¤ºä¾‹ 2: å¤šè¯ç‰‡æ®µæœç´¢</h3>
            <p>è¾“å…¥ <code>j am chem soc</code> æœç´¢ "Journal of the American Chemical Society"</p>
            <input type="text" value="j am chem soc" readonly>
            <button onclick="testSearch('j am chem soc')">æµ‹è¯•</button>
            <div id="result2" class="result"></div>
        </div>

        <div class="example">
            <h3>ç¤ºä¾‹ 3: é¦–å­—æ¯ç¼©å†™</h3>
            <p>è¾“å…¥ <code>jacs</code> æœç´¢ "Journal of the American Chemical Society"</p>
            <input type="text" value="jacs" readonly>
            <button onclick="testSearch('jacs')">æµ‹è¯•</button>
            <div id="result3" class="result"></div>
        </div>

        <div class="example">
            <h3>ç¤ºä¾‹ 4: éƒ¨åˆ†ç¼©å†™</h3>
            <p>è¾“å…¥ <code>adv mat</code> æœç´¢ "Advanced Materials"</p>
            <input type="text" value="adv mat" readonly>
            <button onclick="testSearch('adv mat')">æµ‹è¯•</button>
            <div id="result4" class="result"></div>
        </div>
    </div>

    <script src="journals.js"></script>
    <script>
        const stopWords = new Set(['of', 'the', 'in', 'and', 'for', 'with', 'on', 'at', 'from', 'to', 'an', 'a', 'by']);

        function extractAcronym(journalName) {
            const words = journalName
                .toLowerCase()
                .replace(/[-â€“â€”]/g, ' ')
                .split(/\s+/)
                .filter(word => word.length > 0 && !stopWords.has(word));
            return words.map(word => word.charAt(0)).join('');
        }

        function matchesAcronymFragment(searchTerm, acronym, journalName) {
            if (searchTerm.includes(' ')) {
                const searchFragments = searchTerm.toLowerCase().split(/\s+/).filter(f => f.length > 0);
                const words = journalName
                    .toLowerCase()
                    .replace(/[-â€“â€”]/g, ' ')
                    .split(/\s+/)
                    .filter(word => word.length > 0);

                let matchedIndices = new Set();
                for (const fragment of searchFragments) {
                    let found = false;
                    for (let i = 0; i < words.length; i++) {
                        if (matchedIndices.has(i)) continue;
                        if (words[i].startsWith(fragment)) {
                            matchedIndices.add(i);
                            found = true;
                            break;
                        }
                    }
                    if (!found) return false;
                }
                return true;
            }
            return acronym.includes(searchTerm);
        }

        function searchJournals(query) {
            if (!query || query.trim() === '') return [];
            const results = [];
            const searchTerms = query.toLowerCase().trim();

            for (const [category, journals] of Object.entries(journalsData)) {
                for (const journal of journals) {
                    const journalName = journal.name.toLowerCase();
                    let score = 0;
                    let matchType = '';

                    if (journalName === searchTerms) {
                        score = 100;
                        matchType = 'exact';
                    } else if (journalName.includes(searchTerms)) {
                        score = 50 + (searchTerms.length / journalName.length) * 10;
                        matchType = 'contains';
                    }

                    const acronym = extractAcronym(journal.name);
                    if (acronym === searchTerms) {
                        score = Math.max(score, 80);
                        matchType = 'acronym_exact';
                    } else if (matchesAcronymFragment(searchTerms, acronym, journal.name)) {
                        const fragmentScore = searchTerms.includes(' ') ? 70 : 40;
                        score = Math.max(score, fragmentScore);
                        matchType = searchTerms.includes(' ') ? 'acronym_fragment' : 'acronym_partial';
                    }

                    if (searchTerms.length >= 3 && journalName.startsWith(searchTerms)) {
                        score = Math.max(score, 60);
                        matchType = 'prefix';
                    }

                    if (score > 0) {
                        results.push({
                            name: journal.name,
                            score: score,
                            matchType: matchType,
                            acronym: acronym
                        });
                    }
                }
            }

            return results.sort((a, b) => b.score - a.score);
        }

        function performSearch() {
            const query = document.getElementById('searchInput').value;
            const results = searchJournals(query);
            const resultDiv = document.getElementById('searchResult');

            if (results.length === 0) {
                resultDiv.innerHTML = 'âŒ æœªæ‰¾åˆ°åŒ¹é…çš„æœŸåˆŠ';
            } else {
                let html = `<strong>æ‰¾åˆ° ${results.length} ä¸ªåŒ¹é…ç»“æœï¼š</strong><br><br>`;
                results.slice(0, 5).forEach(r => {
                    html += `<div style="margin: 5px 0;">
                        âœ… <strong>${r.name}</strong><br>
                        &nbsp;&nbsp;&nbsp;ç¼©å†™: <code>${r.acronym}</code> |
                        åŒ¹é…ç±»å‹: <span class="highlight">${r.matchType}</span> |
                        åˆ†æ•°: ${r.score}
                    </div>`;
                });
                if (results.length > 5) {
                    html += `<div style="margin-top: 10px; color: #666;">... è¿˜æœ‰ ${results.length - 5} ä¸ªç»“æœ</div>`;
                }
                resultDiv.innerHTML = html;
            }
            resultDiv.classList.add('show');
        }

        function testSearch(query, resultId) {
            const results = searchJournals(query);
            const resultDiv = event.target.nextElementSibling;

            if (results.length === 0) {
                resultDiv.innerHTML = 'âŒ æœªæ‰¾åˆ°åŒ¹é…çš„æœŸåˆŠ';
            } else {
                let html = `<strong>æ‰¾åˆ° ${results.length} ä¸ªç»“æœï¼š</strong><br><br>`;
                results.slice(0, 3).forEach(r => {
                    html += `<div style="margin: 5px 0;">
                        âœ… <strong>${r.name}</strong><br>
                        &nbsp;&nbsp;&nbsp;ç¼©å†™: <code>${r.acronym}</code> |
                        åŒ¹é…: <span class="highlight">${r.matchType}</span>
                    </div>`;
                });
                resultDiv.innerHTML = html;
            }
            resultDiv.classList.add('show');
        }

        // æ”¯æŒå›è½¦æœç´¢
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') performSearch();
        });
    </script>
</body>
</html>
